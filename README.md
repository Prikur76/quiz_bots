#  Чат-боты для викторин в Telegram и ВКонтакте.
Задают пользователям вопросы в случайном порядке, сравнивают ответы с правильными. 
Если какой-либо бот "сломается", другой, мониторинговый, бот сообщит о проблеме.


Пример tg-бота  ![tg_bot_example](tg_bot_example.gif)     Пример ВК-бота  ![vk_bot_example](vk_bot_example.gif) 


## Как установить

* Python3 должен уже быть установлен.
* Для изоляции проекта рекомендуется использовать [virtualenv/venv](https://docs.python.org/3/library/venv.html).
* Чтобы развернуть зависимости, используйте **`pip`** (или **`pip3`**, если есть конфликт с Python2):

```bash
pip install -r requirements.txt
```
* Для хранения чувствительных данных (токен devman, токен основного бота, токен вспомогательного бота, chat_id пользователя) создайте файл .env 
с переменными **```DF_BOT_TOKEN, SERVICE_BOT_TOKEN, SERVICE_CHAT_ID, VK_COMMUNITY_TOKEN, REDIS_HOST, REDIS_PORT, REDIS_PASSWORD```**.

### Этап 1. Получить все авторизационные ключи
#### Этап 1.1 Для запуска бота в Телеграме необходимо:
1) Создать бота для пользователй в telegram через [Отца ботов](https://telegram.me/BotFather) и взять токен для авторизации.
2) Создать бота для сервисных сообщений в telegram через [Отца ботов](https://telegram.me/BotFather) и взять токен для авторизации.
3) Узнать свой ID через [специального бота](https://telegram.me/userinfobot).

#### Этап 1.2 Для запуска бота во Вконтакте необходимо:
1) [Создать сообщество](https://vk.com/groups?tab=admin) или выбрать из уже созданных, где являетесь администратором.
2) Создать сервисный ключ в разделе "Управление" на вкладке "Работа с API"
3) Разрешить отправку сообщений на вкладке "Сообщения".

#### Этап 1.3 Для сохранения вопросов и ответов викторины, а также для работы с вопросами пользователей необходимо:
1) ВАРИАНТ использования БД на локальном компьютере: установить базу данных Redis с помощью **```Docker```**  [инструкция по Docker Desktop](https://docs.docker.com/desktop/), [инструкция по Redis](https://developer.redis.com/create/docker/redis-on-docker/); 
2) ВАРИАНТ использования БД на стороннем сервере: завести аккаунт на [**```Redislabs```**](https://redislabs.com/) и создать базу данных, получив адрес, например 
```redis-16635.f18.us-east-4-9.wc1.cloud.redislabs.com```, его порт, например ```16635```(порт указан прямо в адресе, через двоеточие) и его пароль.

### Этап 2. Установить переменные окружения
1) **```DF_BOT_TOKEN```**: токен для основного телеграм-бота (например, **```DF_BOT_TOKEN=95193951:wP3db3301vnrob33BZdb33KwP3db3F1I```**);  
2) **```SERVICE_BOT_TOKEN```**: токен для сервисного телеграм-бота;
3) **```SERVICE_CHAT_ID```**: id пользователя телеграм, который будет получать сервисные сообщения;  
4) **```VK_COMMUNITY_TOKEN```**: токен для бота ВКонтакте, например, **```VK_COMMUNITY_TOKEN=vk1.a.1234567890NKVDJNKSDNVBNKD1234567890-DVJNnvlvDLMERVB1234567890```**;
5) **```REDIS_HOST```**: хост БД Redis, например, **```REDIS_HOST=redis-16635.f18.us-east-4-9.wc1.cloud.redislabs.com```**;
6) **```REDIS_PORT```**: порт БД Redis, например, **```REDIS_PORT=16635```**;
7) **```REDIS_PASSWORD```**: пароль БД Redis.

### Этап 3. Запуск ботов на локальном компьютере

1). Для запуска телеграм-бота в терминале введите следующую команду:

```bash
python tg_bot.py
```

2). Для запуска VK-бота в терминале введите следующую команду:

```bash
python vk_bot.py
```

## Как создать викторину
#### Создать модель "вопрос — ответ" с помощью готовых файлов викторин:
* Составить файл *.txt со списком пар вопросов и ответов, разделенных между собой двойными отступами, например:
```
Вопрос: 
Какое слово объединяет льва, леопарда, слона, капусту, огурец, финик, зайца, дьявола и ангела?
Ответ:
морской


Вопрос: 
Талейран на Венском конгрессе 1814-15 годов сказал: "В мире есть пять частей света: Европа, Азия, Америка, Африка и..." А какая еще?,
Ответ: 
Женева
```
Файл с вопросами поместить в отдельную папку.

Примеры вопросов викторин для ботов взяты [отсюда](https://dvmn.org/media/modules_dist/quiz-questions.zip).

* В консоли запустить команду `python` и введите команду 
```bash
python upload_questions.py -sp <PATH-TO-FOLDER> -enc <ENCODING>
```
где **```<PATH-TO-FOLDER>```** - путь до файлов с вопросами викторины,
**```<ENCODING>```** - кодировка файла, по умолчанию - "KOIR-8".

Посмотреть справку по аргументам
```bash
python upload_questions.py --help
```
### Примеры

* [Пример работающего бота в телеграм](https://t.me/shisterov1_bot);
* [Пример работающего бота в VK](https://vk.com/club219380486).

### Цель проекта

Код написан в образовательных целях на онлайн-курсе для веб-разработчиков [dvmn.org](https://dvmn.org).

### Лицензия

Этот проект лицензирован по лицензии MIT - подробности см. в файле [ЛИЦЕНЗИЯ](LICENSE).
